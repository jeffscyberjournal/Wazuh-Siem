# 2.0 Installation of agents
  - 2.1 Install and update using OVA <!--11-->
  - 2.2 Installing agents <!--71-->
    - 2.2.1 Ubuntu linux (DEBIAN) installation <!--76-->
    - 2.2.2 Remove agents Ubuntu <!--111-->
    - 2.2.3 Windows installation <!--174-->
    - 2.2.4 Remove agent Windows <!--202-->

---

## 2.1 Install and update using OVA
So far I tried installation on proxmox and virtualbox installations:

### For VirtualBox 
Download: the Wazuh OVA file from the official Wazuh website.

Import: the OVA file using the "File > Import Appliance" option in VirtualBox.

### For Proxmox
Since Proxmox does not directly support OVA files, you need to convert them. 

Extract: the disk image (VMDK file) from the downloaded OVA file. 

Create: a new virtual machine in Proxmox. 

Attach: the extracted VMDK disk image to the new Proxmox VM. 
Alternatively, use a tool or the tar and qm importovf commands to import and convert the OVA into a format Proxmox can use. 

### For VMware ESXi

Download: the Wazuh OVA file from the official Wazuh website. 

Import: the OVA directly into VMware ESXi using the platform's interface, typically via the "File > Open" or similar "Import Appliance" optio


---

## update using OVA

The OVA from the official Wazuh website I used was a RHEL/CentOS-based system, so this will require using yum:

### 1. Stop Wazuh services (Bash):

sudo systemctl stop wazuh-manager
sudo systemctl stop wazuh-dashboard
sudo systemctl stop wazuh-indexer

### 2. Update the Wazuh repository (if needed, in bash):

sudo yum clean all
sudo yum makecache

### 3. Upgrade Wazuh components (Bash):

sudo yum update wazuh-manager wazuh-dashboard wazuh-indexer

### 4. Start services again (Bash):

sudo systemctl start wazuh-indexer
sudo systemctl start wazuh-manager
sudo systemctl start wazuh-dashboard

### 5. Verify the upgrade: You can check the version with (Bash):

/var/ossec/bin/wazuh-control info
If you’re running a multi-node setup or using custom configurations, it’s best to follow the official Wazuh upgrade guide to avoid version mismatches or config overwrites.


---

## 2.2 Installing agents
This section covers basic agent installation on Ubuntu (Debian-based) and Windows systems, as part of integrating Wazuh into a home lab SIEM setup. Here is the manual method as apposed to the method through wazuh interface. I found the wazuh interface did not work well for Ubuntu agent and required either installation of agent from the Wazuh home page or using a manual install. Installing the agents appeared straight forward through the wazuh interface, working perfectly for Windows except Ubuntu agent seemed to fail. The following manual method works fine for either.

---

## 2.2.1 Ubuntu (Debian-based)

Install Wazuh Agent:

curl -so wazuh-agent.deb https://packages.wazuh.com/4.x/apt/pool/main/w/wazuh-agent/wazuh-agent_4.1.5-1_amd64.deb && \

```
sudo WAZUH_MANAGER='<WAZUH_MANAGER_IP>' WAZUH_AGENT_GROUP='default' dpkg -i ./wazuh-agent.deb
sudo systemctl daemon-reload
sudo systemctl enable wazuh-agent
sudo systemctl start wazuh-agent
```
### Register Agent:


`/var/ossec/bin/agent-auth -m <WAZUH_MANAGER_IP>`

### Edit Configuration File:

nano /var/ossec/etc/ossec.conf

```<client>
  <server>
    <address>10.10.10.110</address>
    ...
  </server>
</client>```


### Restart Agent:

sudo systemctl restart wazuh-agent

---

## 2.2.2 Remove agents Ubuntu

To remove the **Wazuh user agent** on Ubuntu using the **Wazuh manager**, follow these steps:

### **Using the CLI on the Wazuh Manager**
#### 1. **Access the Wazuh Manager**  
   Run the following command on the Wazuh server (bash)

   /var/ossec/bin/manage_agents

#### 2. **Select the Remove Option**  
   You'll see a menu like this:
  
   ****************************************
   * Wazuh v4.8.0 Agent manager. *
   * The following options are available: *
   ****************************************
   (A)dd an agent (A).
   (E)xtract key for an agent (E).
   (L)ist already added agents (L).
   (R)emove an agent (R).
   (Q)uit.
   Choose your action: A,E,L,R or Q:
   
   Type `R` to remove an agent.

#### 3. **Select the Agent to Remove**  
   The system will list available agents:
   
   Available agents:
   ID: 002, Name: Ubuntu, IP: any
   Provide the ID of the agent to be removed (or '\q' to quit): 002
   
   Enter the **agent ID** you want to remove.

#### 4. **Confirm Removal**  
   The system will ask for confirmation:
   
   Confirm deleting it?(y/n): y
   
   Type `y` to proceed.

#### 5. **Exit the Manager**  

   Once the agent is removed, exit the manager:
   
   manage_agents: Exiting.
   

### **Alternative: Using APT**
If you want to **completely uninstall** the Wazuh agent from Ubuntu, run (bash):

sudo apt-get remove --purge wazuh-agent

Then, delete any remaining files (bash):

sudo rm -rf /var/ossec/


For more details, check out [this guide](https://documentation.wazuh.com/current/installation-guide/uninstalling-wazuh/agent.html) or [this documentation](https://documentation.wazuh.com/current/user-manual/agent/agent-management/remove-agents/remove.html). 

---

## 2.2.3 Windows:
Install Wazuh Agent (using powershell):

Invoke-WebRequest -Uri https://packages.wazuh.com/4.x/windows/wazuh-agent-4.1.5-1.msi -OutFile wazuh-agent.msi
Start-Process -FilePath .\wazuh-agent.msi -ArgumentList "/q WAZUH_MANAGER='<WAZUH_MANAGER_IP>' WAZUH_REGISTRATION_SERVER='<WAZUH_MANAGER_IP>' WAZUH_AGENT_GROUP='default'" -Wait

### Register Agent (powershell):

'C:\Program Files (x86)\ossec-agent\agent-auth.exe' -m <WAZUH_MANAGER_IP>

### Edit Configuration File:

C:\Program Files (x86)\ossec-agent\ossec.conf

```<client>
  <server>
    <address10.10.10.110</address>
    ...
  </server>
</client>```


### Restart Agent (powershell):

Restart-Service -Name wazuh

---

## 2.2.4 Remove agent Windows

Removing the **Wazuh agent** on Windows is slightly different from Ubuntu. Here’s how you can do it:

### **Using the Wazuh Manager (CLI)**

#### 1. Open a **Command Prompt** as Administrator.

#### 2. Navigate to the Wazuh installation directory (bash):

   cd "C:\Program Files (x86)\ossec-agent"
   
#### 3. Run the **manage_agents** tool (bash):

   manage_agents.exe
   
#### 4. Select the **Remove Agent** option (`R`), then enter the agent ID.

#### 5. Confirm the removal when prompted.

### **Uninstalling via Windows Installer**

#### 1. Open **Command Prompt** as Administrator.

#### 2. Run the following command (bash):

   msiexec.exe /x wazuh-agent-4.11.1-1.msi /qn
   
   Replace `wazuh-agent-4.11.1-1.msi` with the correct version installed on your system.

### **Alternative: Using PowerShell**

#### 1. Open **PowerShell** as Administrator.
#### 2. Run (powershell):

   Get-WmiObject -Query "SELECT * FROM Win32_Product WHERE Name='Wazuh Agent'" | ForEach-Object { $_.Uninstall() }
   
#### 3. Delete any remaining files (powershell):

   Remove-Item -Recurse -Force "C:\Program Files (x86)\ossec-agent"
   

For more details, check out [this guide](https://documentation.wazuh.com/current/installation-guide/uninstalling-wazuh/agent.html) or [this documentation](https://documentation.wazuh.com/current/user-manual/agent/agent-management/remove-agents/index.html).

